clear all, close all
% curves will be fitted for this degrees of polynomial:
poldegree = 1:30;

% curve for 4 MS/s %<<<1
c4 = [...
1.7 2.16; ...
5.25 2.21; ...
10.49 1.79; ...
15.89 1.37; ...
20.9 -0.24; ...
26.01 -1.31; ...
30.85 -0.87; ...
35.52 -1.38; ...
40.29 -1.44; ...
45.67 -0.88; ...
50.64 0.27; ...
55.83 1.83; ...
60.2 3.63; ...
65.63 5.28; ...
70.67 7.24; ...
75.41 9.44; ...
80.58 10.72; ...
84.83 10.41; ...
90.52 11.56; ...
95.66 11.01; ...
100.66 9.98; ...
105.68 8.28; ...
110.81 7.21; ...
115.71 5.78; ...
120.23 4.54; ...
125.53 4.11; ...
130.22 4.29; ...
135.74 4.57; ...
141.07 5.2; ...
145.95 6.5; ...
150.27 7.93; ...
155.68 10.10; ...
160.28 12.39; ...
165.21 12.79; ...
170.38 14.75; ...
175.75 15.15; ...
180.3 14.29; ...
186.04 12.54; ...
190 12.11; ...
196.27 10.06; ...
200.77 8.85; ...
205.6 7.08; ...
210.34 7.08; ...
215.3 5.59; ...
220.19 5.83; ...
225.06 7.17; ...
230.82 8.27; ...
235.47 10.79; ...
240.56 12.44; ...
245.16 13.98; ...
251.05 15.53; ...
255.97 16.23; ...
260.29 16.37; ...
264.91 15.86; ...
270.77 13.96; ...
275.24 13; ...
280.1 10.44; ...
285.49 9.74; ...
291.39 8.07; ...
295.12 7.51; ...
300.42 8.18; ...
305.27 8.81; ...
310.05 10.48; ...
314.99 12.91; ...
320.49 14.98; ...
324.88 17.29; ...
330.36 18.01; ...
335.36 18.91; ...
341.23 18.35; ...
345.68 16.41; ...
350.26 15.31; ...
354.8 13.31; ...
360.31 11.89; ...
365.75 10.39; ...
370.23 11.02; ...
375.23 13.7; ...
381.9 16.54; ...
385.52 20.34; ...
390.27 20.97; ...
395.91 17.66; ...
400.2 8.58; ...
406.27 -19.55; ...
409.72 -53.24; ...
411.18 -65.61; ...
415.88 -127.99; ...
420.15 -200.91; ...
];
c4(:,1) = c4(:,1)./1000; % set proper order - frequency in f/fs ratio
c4(:,2) = c4(:,2)./10000; % set proper order - error in V/V

c4x = c4(:,1);
c4y = c4(:,2);
poldegree = 1:30;
for i = 1:numel(poldegree)
    [c4P{i} c4S{i} c4MU{i}] = polyfit(c4x, c4y, poldegree(i));
    c4fitvalues{i} = polyval(c4P{i}, c4x, c4S{i}, c4MU{i});
    c4rms(i) = sum(sqrt(mean((c4fitvalues{i} - c4y).^2)));
end
% optimal polynom is of order 21-22 for c4
figure
plot(c4x, c4y, '-k', c4x, c4fitvalues{21},'-r')
title('c4 - NI5922 4 MSa/s')
xlabel('f/fs')
ylabel('G_ADC - 1 (V/V)')

% curve for 10 MS/s %<<<1
c10 = [...
1.49 1.58; ...
5.44 -0.51; ...
7.94 -3.26; ...
10.74 -6.78; ...
13.45 -11.85; ...
16.45 -18.39; ...
19.16 -24.67; ...
21.6 -30.82; ...
24.47 -36.92; ...
26.99 -42.55; ...
29.01 -47.43; ...
31.86 -50.70; ...
34.69 -52.48; ...
36.96 -52.77; ...
39.74 -51.53; ...
42.54 -48.64; ...
45.17 -44.25; ...
47.99 -37.45; ...
50.36 -30.64; ...
53 -20.38; ...
55.83 -10.37; ...
58 -1.86; ...
61.16 12.31; ...
64.3 22.58; ...
66.37 32.84; ...
69.31 42.83; ...
71.84 50.35; ...
74.83 57.08; ...
76.99 60.88; ...
79.07 62.97; ...
81.74 63.36; ...
84.86 61.42; ...
87.54 57.97; ...
90.31 51.61; ...
92.84 44.07; ...
95.51 35.54; ...
98.24 25.36; ...
101.05 15.23; ...
103.17 4.56; ...
106.03 -5.97; ...
108.99 -16.5; ...
111.51 -25.77; ...
114.25 -32.28; ...
116.81 -38.06; ...
119.62 -41.27; ...
121.98 -42.21; ...
124.26 -40.82; ...
127.37 -37.91; ...
129.98 -32.63; ...
132.52 -25.73; ...
135.21 -17.6; ...
137.75 -6.73; ...
140.56 5.45; ...
142.87 15.27; ...
145.64 27.13; ...
148.29 38.09; ...
151.01 48.81; ...
154.21 58.16; ...
156.22 64.47; ...
158.92 69.91; ...
161.8 73.34; ...
164.14 73.77; ...
166.74 72.83; ...
169.57 69.30; ...
172.36 63.42; ...
175.04 56.43; ...
177.47 46.76; ...
180.24 38.14; ...
182.81 26.34; ...
185.77 15.85; ...
188.24 5.23; ...
190.86 -5.55; ...
193.40 -14.07; ...
196.08 -20.91; ...
198.58 -27.11; ...
201.34 -30.73; ...
203.75 -31.64; ...
206.67 -30.6; ...
209.15 -27.8; ...
211.71 -22.7; ...
214.62 -15.23; ...
217.23 -5.18; ...
219.3 3.32; ...
222.72 17.42; ...
225.04 26.89; ...
227.94 39.89; ...
230.42 49.94; ...
233.46 62.45; ...
235.73 70.09; ...
238.27 76.29; ...
240.99 81.19; ...
244.22 83.53; ...
246.16 83.73; ...
248.76 82.33; ...
251.46 78.46; ...
254.05 72.84; ...
256.88 64.84; ...
259.5 54.8; ...
262.28 44.48; ...
265.01 33.77; ...
267.88 21.58; ...
270.24 10.51; ...
272.68 0.91; ...
275.49 -7.16; ...
278.01 -13.64; ...
281.35 -18.35; ...
283.34 -20.46; ...
285.80 -19.68; ...
288.53 -17.21; ...
291.43 -11.83; ...
293.91 -5.5; ...
296.62 5.12; ...
299.19 14.77; ...
301.68 26.44; ...
304.53 39.26; ...
307.08 50.90; ...
309.47 62.98; ...
312.43 74.27; ...
314.78 82.42; ...
317.6 89.91; ...
320.19 94.97; ...
323.22 96.78; ...
325.62 95.85; ...
328.23 92.61; ...
330.90 87.52; ...
333.48 78.86; ...
336.25 69.23; ...
339.08 57.56; ...
341.43 45.64; ...
344.05 31.82; ...
347 20.67; ...
349.64 10.22; ...
352.14 0.56; ...
354.95 -5.27; ...
357.56 -8.08; ...
360.19 -7.55; ...
362.69 -4.62; ...
365.23 2.65; ...
368.18 13.95; ...
370.95 27.85; ...
373.08 40.94; ...
375.79 58.18; ...
378.68 74.69; ...
381.06 89.07; ...
383.56 98.93; ...
386.29 104.53; ...
389.68 100.16; ...
391.88 89.81; ...
394.85 67.19; ...
397.14 27.81; ...
399.86 -32.91; ...
402.63 -103.79; ...
404.96 -197.4; ...
];
c10(:,1) = c10(:,1)./1000; % set proper order - frequency in f/fs ratio
c10(:,2) = c10(:,2)./10000; % set proper order - error in V/V

c10x = c10(:,1);
c10y = c10(:,2);
for i = 1:numel(poldegree)
    [c10P{i} c10S{i} c10MU{i}] = polyfit(c10x, c10y, poldegree(i));
    c10fitvalues{i} = polyval(c10P{i}, c10x, c10S{i}, c10MU{i});
    c10rms(i) = sum(sqrt(mean((c10fitvalues{i} - c10y).^2)));
end
% optimal polynom is of order 21-22 for c10
figure
plot(c10x, c10y, '-k', c10x, c10fitvalues{21},'-r')
title('c10 - NI5922 10 MSa/s')
xlabel('f/fs')
ylabel('G_ADC - 1 (V/V)')

% curve for 15 MS/s %<<<1
c15 = [...
2.02 2.04; ...
5.7 5.79; ...
10.75 20.89; ...
15.92 42.8; ...
21.3 71.65; ...
26.85 103.6; ...
31.98 126.63; ...
37.31 141.71; ...
42.51 144.98; ...
48.43 131.53; ...
53.69 107.6; ...
58.64 66.76; ...
63.88 27.35; ...
68.67 -17.74; ...
75.1 -71.02; ...
80.13 -100.44; ...
86.07 -119.14; ...
90.06 -120.35; ...
95.53 -105.05; ...
101.16 -72.1; ...
105.87 -33.03; ...
111.02 11.54; ...
116.73 71.09; ...
121.78 114.21; ...
127.19 147.44; ...
132.2 164.89; ...
137.74 164.45; ...
143.78 143.28; ...
149.34 105.48; ...
154.21 63.94; ...
159.26 18.19; ...
164.62 -31.38; ...
170.5 -73.01; ...
175.37 -92.87; ...
180.11 -97.02; ...
185.48 -84.63; ...
190.89 -52.65; ...
195.84 -13.43; ...
200.92 35.84; ...
206.48 89.71; ...
211.77 138.35; ...
217.01 170.16; ...
222.32 188.65; ...
228.06 186.22; ...
234.05 161.2; ...
239.31 121.86; ...
244.27 77.72; ...
250.01 22.66; ...
254.39 -15.11; ...
260.65 -54.28; ...
265.39 -71.89; ...
269.7 -72.61; ...
275.16 -54.12; ...
280.59 -19.32; ...
286.33 33.2; ...
290.93 82.19; ...
296.73 137.35; ...
301.84 178.77; ...
306.80 204.5; ...
313.01 210.13; ...
318.43 192.87; ...
324.26 151.88; ...
328.64 108.85; ...
333.99 50.67; ...
339.73 -3.44; ...
344.91 -38.56; ...
350.33 -56.55; ...
355.61 -48.60; ...
360.23 -18.83; ...
365.62 35.13; ...
370.62 99.65; ...
376.23 158.1; ...
381.2 208.96; ...
387.6 205.28; ...
392.9 128.15; ...
396.27 37.52; ...
400.56 -140.12; ...
401.97 -196.16; ...
];
c15(:,1) = c15(:,1)./1000; % set proper order - frequency in f/fs ratio
c15(:,2) = c15(:,2)./10000; % set proper order - error in V/V

c15x = c15(:,1);
c15y = c15(:,2);
for i = 1:numel(poldegree)
    [c15P{i} c15S{i} c15MU{i}] = polyfit(c15x, c15y, poldegree(i));
    c15fitvalues{i} = polyval(c15P{i}, c15x, c15S{i}, c15MU{i});
    c15rms(i) = sum(sqrt(mean((c15fitvalues{i} - c15y).^2)));
end
% optimal polynom is of order 21-22 for c15
figure
plot(c15x, c15y, '-k', c15x, c15fitvalues{21},'-r')
title('c15 - NI5922 15 MSa/s')
xlabel('f/fs')
ylabel('G_ADC - 1 (V/V)')

fs4P = c4P{21};
fs4S = c4S{21};
fs4MU = c4MU{21};
fs10P = c10P{21};
fs10S = c10S{21};
fs10MU = c10MU{21};
fs15P = c15P{21};
fs15S = c15S{21};
fs15MU = c15MU{21};
save('-v6', 'NI5922_FR_simulator_polynomial_data.mat', 'fs4P', 'fs4S', 'fs4MU', 'fs10P', 'fs10S', 'fs10MU', 'fs15P', 'fs15S', 'fs15MU');
